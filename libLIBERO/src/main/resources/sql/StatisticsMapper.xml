<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="StatisticsMapper">

	<resultMap id="stSelectMap" type="statistics">
		<result property="prodNo"			column="prod_no"			jdbcType="INTEGER"/>
		<result property="day" 				column="day" 				jdbcType="VARCHAR"/>
		<result property="dayCount" 		column="day_count" 			jdbcType="INTEGER"/>
	</resultMap>
	
	<select id="getDateStatistics"	parameterType="statistics"	resultMap="stSelectMap">
		SELECT DATE_FORMAT(pay_date,'%Y-%m') day, SUM(buy_amount) day_count FROM pay p
		JOIN buy b
		ON b.pay_no = p.pay_no
		<if test="startDate != 0">
			WHERE pay_date BETWEEN #{startDate} AND #{endDate}
		</if>
		AND b.prod_no IN(#{prodNo})
	 	GROUP BY day;
	</select>
</mapper>